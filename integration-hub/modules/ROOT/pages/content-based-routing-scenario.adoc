= Content-Based Routing Routing Scenario

In this scenario, a xref:glossary#p[Partner] sends your organization a xref:glossary#d[Document]. Depending on the size of a property in that document you either send that document to an xref:glossary#e[Endpoint] *DATA-Big* or an endpoint *DATA-Small*.

== Relationships

There are two xref:glossary#r[Relationships] in this scenario:

.Content-Based Routing Scenario Relationships
[cols="3*"]

|===
|Relationship|Description|Contains

s|_YourCompany_ B2B : Any
|Universal relationship between your company any partner
|Artifacts used across all partners with whom you do business

s|_YourCompany_ B2B : PartA
|Your organization's relationship with the partner with whom you are doing business (in this case, *PartA*)
|Artifacts used only with Partner *PartA*
|===

[[img-content-based-routing-scenario-artifacts]]

image::content-based-routing-scenario-artifacts.png[img-content-based-routing-scenario-artifacts, title="Content-Based Routing Scenario Artifacts"]

== Artifacts and Artifact Configuration 

This section identifies:

* Artifacts that must be configured in order for the document in this scenario to be routed (that is, not rejected)
* The Relationship (either *_YourCompany_ B2B : Any* or *_YourCompany B2B_ : PartA*) in which the artifacts are configured


//== Configured in *YourCompany B2B : Any*

.Content-Based Scenario Artifacts - *_YourCompany B2B_ : Any*
[cols="4*" grid=all]

|===
h|Artifact|Artifact Name|Description|Configured on page

h|xref:glossary#d[Document Type]
s|X
|Document Type you use internally in your company
|xref:document-types.adoc[Document Types]

h|xref:glossary#d[Document Type]
s|Y
|Document Type you expect to receive from a partner
|xref:document-types.adoc[Document Types]

h|xref:glossary#m[Map]
s|Y-to-X
|Transforms a document of Document Type *Y* to a document of Document Type *X*
|xref:document-types.adoc[Maps]

|xref:glossary#s[Source Channel]
|*Y-to-X*
|Sends Document of Document Type *Y* to Type *X*. 
|xref:channels.adoc[Channels] 


h|xref:glossary#e[Endpoint]
s|Data-Small
|Endpoint that points to the internal database for the Small type
|xref:endpoints.adoc[Endpoints] 

h|xref:glossary#e[Endpoint]
s|Data-Big
|Endpoint that points to the internal database for the Big type
|xref:endpoints.adoc[Endpoints] 

|xref:glossary#t[Target Channel]
s|X-to-DATA-Small
|Channel that sends a document of the internal Document Type *X* to Endpoint *DATA-Small*
|xref:channels.adoc[Channels] 

|xref:glossary#t[Target Channel]
s|X-to-DATA-Small
|Channel that sends a document of the internal Document Type *X* to Endpoint *DATA-Big*
|xref:channels.adoc[Channels] 

|===

//== Configured in _YourCompany_ B2B : PartA

.Content-Based Scenario Artifacts - _YourCompany_ B2B : PartA

[cols="2, 2, 6, 2"]
|===
|Artifact|Artifact Name|Description|Configured on page

|xref:glossary#e[Endpoint]
|*RecFromA*
|Endpoint at which you expect to receive documents from *PartA*
|xref:endpoints[Endpoints] 

|xref:glossary#t[Transaction]
s|Y-to-X-to-DATA-Small
|combination of the Source Channel *Y-to-X* and the Target Channel **X-to-DATA-Small**. It includes a filter that evaluates propertyA to be less Than 10. If a Document Q matches this filter then it will be a transaction that receives the document and maps it to Document Type *X*, then  sends it to the database *DATA-Small*. This Transaction has *From Partner* configured as *PartA* and *To Partner* configured as **_Your Company_ B2B**.
|xref:channels.adoc[transaction-designer] 

|xref:glossary#t[Transaction]
s|Y-to-X-to-DATA-Big
|Combination of the Source Channel *Y-to-X* and the Target Channel **X-to-DATA-Big**. It includes a filter that evaluates propertyA to be greater than or equal to 10. If a Document Q matches this filter then it will be a transaction that receives the document and maps it to Document Type *X*, then  sends it to the database *DATA-Big*. This Transaction has *From Partner* configured as *PartA* and *To Partner* configured as **_Your Company_ B2B**.
|xref:channels.adoc[transaction-designer] 

|===

== Outcomes

=== *PartA* sends Document of Document Type *Y* to Endpoint **RecFromA**; PropertyA = 5

image::cbr-routing-scenario-data-small.png[img-cbr-routing-scenario-data-small, title="Content-Based Routing Outcome"]


Integration Hub:

* Receives Document 
* Attempts to resolve routes
* Finds two Transactions:
** **Y-to-X-to-DATA-Small** and *Y-to-X-to-DATA-Big*
* Evaluates Filters
** Evaluates PropertyA
*** Finds PropertyA < 10
* Executes that transaction, which maps Document Type *Y* to Type *X*
* Sends Document X to Endpoint **DATA-Small**

=== *PartA* sends Document of Document Type *Y* to Endpoint **RecFromA**; PropertyA = 12

image::cbr-routing-scenario-data-big.png[img-cbr-routing-scenario-data-big, title="Content-Based Routing Outcome"]

Integration Manager:

* Receives Document 
* Attempts to resolve routes
* Finds two Transactions:
** **Y-to-X-to-DATA-Small** and *Y-to-X-to-DATA-Big*
* Evaluates Filters
** Evaluates PropertyA
*** Finds PropertyA > 10
* Executes that transaction, which maps Document Type *Y* to Type *X*
* Sends Document X to Endpoint **DATA-Big**

==== PartnerA sends Document Q to Endpoint RecFromA. with PropertyA = 10

* Receives Document 
* Attempts to resolve routes
* Finds two Transactions:
** **Y-to-X-to-DATA-Small** and *Y-to-X-to-DATA-Big*
* Evaluates Filters
** Evaluates PropertyA
*** Finds PropertyA = 10
* Executes that transaction, which maps Document Type *Y* to Type *X*
* Sends Document X to Endpoint **DATA-Big**
