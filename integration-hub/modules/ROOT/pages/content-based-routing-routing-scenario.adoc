= Content-Based Routing Scenario

In this scenario, your organization receives a xref:glossary#sectd[Document] from a xref:glossary#sectp[Partner]. 
If IHub has been configured to receive a document of this xref:glossary#sectd[Document Type], IHub routes the document to an internal API. 
If IHub has not been configured to receive a document of this Document Type, IHub rejects the document. 


== Relationships

There are two xref:glossary#sectr[Relationships] in this scenario:

.Content-Based Routing Scenario Relationships
[cols="3*"]

|===
|Relationship|Description|Contains

s|_YourCompany_ B2B : Any
|Universal relationship between your company any partner
|Contains Artifacts used across all partners with whom you do business

s|_YourCompany_ B2B : PartA
|Your organization's relationship with the partner with whom you are doing business (in this case, *PartA*)
|Contains Artifacts used only with Partner *PartA*
|===

[[img-content-based-routing-scenario-artifacts]]

image::content-based-routing-scenario-artifacts.png[img-content-based-routing-scenario-artifacts, title="Content-Based Routing Scenario Artifacts"]

== Artifacts and Artifact Configuration 

This section identifies:

* Artifacts that must be configured in order for the document in this scenario to be routed (that is, not rejected)
* The Relationship (either *_YourCompany_ B2B : Any* or *_YourCompany B2B_ : PartA*) in which the artifacts are configured


//== Configured in *YourCompany B2B : Any*

.Content-Based Scenario Artifacts - *_YourCompany B2B_ : Any*
[cols="4*" grid=all]

|===
h|Artifact|Artifact Name|Description|Configured on page

h|xref:glossary#sectd[Document Type]
s|X
|Document Type you use internally in your company
|xref:document-types.adoc[Document Types]

h|xref:glossary#sectd[Document Type]
s|Y
|Document Type you expect to receive from a partner
|xref:document-types.adoc[Document Types]

h|xref:glossary#sectm[Map]
s|Y-to-X
|Transforms a document of Document Type *Y* to a document of Document Type *X*
|xref:document-types.adoc[Maps]

h|xref:glossary#secte[Endpoint]
s|API
|Endpoint that points to an internal API
|xref:endpoints.adoc[Endpoints] 

h|xref:glossary#sectt[Target Channel]
s|X-to-API
|Channel that sends a document of the internal Document Type *X* to Endpoint *API*
|xref:channels.adoc[Channels] 

h|xref:glossary#secte[RecFromA]
s|API
|Endpoint from which you expect to receive documents from *PartA*. 
|xref:endpoints.adoc[Endpoints] 

h|xref:glossary#sectt[Transaction]
s|Y-to-X-to-API
|Combination of Source Channel *Y-to-X* and  Target Channel *X-to-API*.
It receives a document of Document Type *Y*, maps it to a document of Document Type *X* and then sends it to Endpoint *API*. 
In this Transaction, the From Partner is configured as *PartA* and the To Partner as *_YourCompany_ B2B*. 

|===

//== Configured in _YourCompany_ B2B : PartA

.Content-Based Scenario Artifacts - _YourCompany_ B2B : PartA

[cols="2, 2, 6, 2"]
|===
|Artifact|Artifact Name|Description|Configured on page

|xref:glossary#secte[Endpoint]
|*RecFromA*
|Endpoint at which you expect to receive documents from *PartA*
|xref:endpoints[Endpoints] 

|xref:glossary#sectd[Document Type]
|*Y*
|Document Type that includes a document you expect to receive from *PartA*
|xref:document-types[Document Types]

|xref:glossary#sectm[Map] 
|*Y-to-X*
|Transforms a document of Document Type *Y* to a document of Document Type *X*
|xref:maps[Maps]

|xref:glossary#sects[Source Channel]
|*Y-to-X*
|Includes the process that maps and sends a document of *Y* to a document of *X*
|xref:channels[Channels] 

|xref:glossary#sect[Transaction] 
|*Y-to-X-to-API*
|Combination of the Source Channel *Y-to-X* and the Target Channel *X-to-API*.
It receives a document of *Y*, maps it to a document of *X* and then sends it to Endpoint *API*. 
In this Transaction, the *From* Partner is configured as *PartA* and the *To* Partner as *YourCompany B2B*.
|xref:transaction-designer[Transaction Designer] 

|===

== Outcomes

If the artifacts in the previous section have been configured correctly, then document discussed above will be <<Document Accepted and Routed, accepted and routed>>. 

Otherwise, the document will be <<Document Rejected, rejected>>.

////

The outcome of this scenario depends on whether the following artifacts are configured appropriately:

* Partner *PartA*
* Document Type *Y*
* Document Type *X*
* Endpoint *RecFromA*
* Endpoint *API*
* Target Channel *X-to-API*
* Source Channel *Y-to-X*
* Transaction *Y-to-X-to-API*

////

////

.Content-Based Routing Scenario Artifact Summary 
[cols="8*",options="header", e]
[grid=all]
|===
|Relationship
7+^|Artifact Type 
||Partners|Document Types|Maps|Endpoints 
2+^|Channels|Transactions

5+||Source|Target|

h|_YourCompany_ B2B : Any
s|
s|X
s|
s|API
s|
s|X-to-API
|

h|_YourCompany_ B2B : PartA
s|PartA
s|Y
s|Y-to-X
s|RecFromA
s|Y-to-X
s|
s|Y-to-X-to-API

||||||||
||||||||
||||||||
||||||||
|===


.Content-Based Routing Scenario Artifact Summary Version Two 
[cols="4*",options="header", e]
[grid=all]
|===
|Relationship 2+|Artifact Type|Artifact Name

.7+s|_YourCompany_ B2B : Any
2+|Partners
|

2+|Document Type
s|X

2+|Maps
|


|Endpoints
|
|API

.2+|Channels
|Source
|

|Target
s|X-to-API

2+|Transactions
s|Y-toX-to-API

.7+s|_YourCompany_ B2B : PartA
2+|Partners
s|PartA

2+|Document Type
s|Y

2+|Maps
s|Y-to-X


|Endpoints
|
s|API

.2+|Channels
|Source
|

|Target
s|Y-to-X

2+|Transactions
s|Y-toX-to-API

|===


////

== Document Accepted and Routed

All artifacts are correctly configured; IHub routes an incoming document of Document Type *Y* from Partner *PartA* to Endpoint *RecFromA*.

[[img-content-based-routing-scenario-outcome-success]]

image::content-based-routing-scenario-outcome-success.png[img-content-based-routing-scenario-outcome-success, title="Content-Based Routing Scenario Outcome (Success)"]

Integration Hub:

* Receives a document of Document Type *Y*
* Attempts to resolve routes
** Finds a Transaction *Y-to-X-to-API* that contains *Y*.
* Executes Transaction *Y-to-X-to-API*, which transforms the Document from *X* to *Y*
* Sends the document to Endpoint *API*.




== Document Rejected

Partner *PartA* sends a document of Document Type *Z* to Endpoint *RecFromA*. 
Document Type *Z* is not configured in Relationship *_YourCompany_ B2B : Any*; IHub rejects the document. 

[[img-content-based-routing-scenario-outcome-rejection]]

image::content-based-routing-scenario-outcome-rejection.png[img-content-based-routing-scenario-outcome-rejection, title="Content-Based Routing Scenario Outcome (Rejection)"]

Integration Hub:

* Receives incoming document
* Attempts to resolve Routes
* Does not find a corresponding Transaction
* Rejects the document.



