= Hello Integration Hub

This tutorial:

* Illustrates the role Integration Hub plays in enterprise integration.

* Introduces Transaction Designer, an Integration Hub feature that enables you to design the elements of a transaction from beginning to end.

* Provides instructions for using Transaction Designer to configure Integration Hub so that you can simulate a transaction and see how Integration Hub processes it.

== Use case

_FastBoards_ is a manufacturer of premium skateboards used by Olympians and professional X-gamers. 
Because of their premium quality and growing customer base, they are growing very quickly in terms of volume and acquisitions.
That means they need to be very agile with integration between multiple systems and rapid implementation. 
FastBoards uses SAP as their ERP system and is currently integrated with legacy mainframe systems. 
But the new IT leadership realizes and feels the need to modernize the infrastructure and decided to add Salesforce as their CRM and Magento as their ECOM platform. 
With the growing number acquisitions, the number of systems required to connect with SAP also keeps growing. 
FastBoards also needs to connect to their Business partners, where GearCo is their retailer and RoundWheels is their supplier/vendor.

[[img-use-cases, Use Cases]]

image::tutorial/use-cases.png[img-use-cases, title="Use Cases"]

In this tutorial, we cover the following scenarios

When a shipment is ready, SAP populates a Shipment IDOC ( ZDELVRY03_620) message. This needs to be broadcasted to all the connected systems (LEGACY mainframe, Salesforce and E-commerce platform). Since FastWheels management realizes the importance of API-led architecture, the System APIs for each of the underlying systems are already present.

=== SAP to Legacy

* When ZDELIVERY_620 message is received, it needs to be transformed to Legacy system API format in JSON.
* The message is then sent to the System API endpoint.
*  not require any filter operation

=== SAP to Salesforce

* When ZDELIVERY_620 message is received, it needs to be transformed to SalesForce system API format in JSON 
* The message is then sent to the System API endpoint.
* No filter

=== SAP to E-Commerce

When ZDELIVERY_620 message is received, it needs to be transformed to E-commerce system API format in JSON.
The message is then sent to the System API endpoint.
Does not require any filter operation

=== SAP to GearCo (B2B Partner)

* When ZDELIVERY_620 message is received, it is also intended to be sent out as X12 856 to GearCo
** Transform and Render to EDI X12 856 ( ASN ) for GearCo.
* Route the message to the designated partner endpoint.
* The message will only be sent to B2B process the message content indicates EDI message indicates the partner GearCo

_<Where do the following steps go?>_

Integration Hub initial setup
Routing engine setup
SAP to Salesforce integration 


In this example, we are configuring SAP to Salesforce integration. Rest of the application can be integrated just the same.

== Before you Begin

Verify that you have the following:

* Anypoint Platform user account with Integration Hub access

* URL: https://tpm-service-release-8.dev.portx.io/portal

_This is the account I use for documenting the UI. Are we sure we want to make the credentials public?_

* User Name: demo@modusbox.com
* Password: SMiarbY2!


If you are unable to access Integration Hub, see your PortX account administrator for assistance, or to set up a trial account.


* Anypoint Studio with Mule 3.9.1
* link:https://modusbox.atlassian.net/wiki/download/attachments/344719433/Json%20Target%20Dataweave.dwl?api=v2Json[Target Dataweave.dwl]
* link:https://modusbox.atlassian.net/wiki/download/attachments/344719433/PortX%20Workshop.postman_collection.json?api=v2[PortX Workshop.postman_collection.json]



== Integration Hub Initial Setup

. Create an S3 bucket for Integration Hub persistence
. Specify authentication for S3 persistence 
. Retrieve API key (Please make sure to create API only for your environment. Please read and follow the warnings given)
. Follow instructions to retrieve the environment and retrieve the environment id for your environment


== Routing engine setup

. Download the latest from Git Hub
. Update the _(which?)_ Settings file XML with latest modus jfrog creds
. Update the property file with the following
. Update the Properties with files with PortX api, tracker and environment Id and api key
. Retrieve the Environment id and API key for the PortX environment to which you are trying to connect
. Get the S3 configuration and update
. Update the Partner name
, Make sure application property/ muleproject.xml is updated with the correct environment and tenant information


== Get Started

=== Configure SAP Application

. Open PortX Integration Hub. On the left-hand menu, click Partners and Applications.
. Click Add Application. 


[[img-create-app, Create App]]
image::tutorial/create-app.png[img-create-app, title="Create App"]



. Enter Application Name (SAP)  and contact information 
. Click save
. On the left-hand menu click on View Relationships. 
. Select SAP ↔ *Any 

[[img-relationships, Relationships]]
image::tutorial/relationships.png[img-relationships, title="Relationships"]

This will allow you to define all the artifacts/resources that pertain to domain SAP.

. Click Transaction Design  on the right-hand side menu and click Create template.

[[img-td, Transaction Designer]]
image::tutorial/td.png[img-td, title="Transaction Designer"]

This will open up New Transaction view.

[[img-new-transaction, New Transaction]]
image::tutorial/new-transaction.png[img-new-transaction, title="New Transaction"]

. On the Source Channel click Create New Channel.

[[img-create-source-channel, Create Source Channel]]
image::tutorial/create-source-channel.png[img-create-source-channel, title="Create Source Channel"]


. Click *New Document*. +
This should open Create Document window; no need to enter a name, it will be auto-generated.


[[img-create-document, Create Document]]
image::tutorial/create-document.png[img-create-document, title="Create Document"]


. Select XML as the standard
. Leave namespace empty
. Enter root node of the XML document as message type in our case enter ZDELVRY03_620
. Go to the property tab and click *Add Property*

[[img-add-property, Add Property]]
image::tutorial/add-property.png[img-add-property, title="Add Property"]

. Select EDIProcess-Demo if property not added you can add new property
. In the Property Source Type  select Document
. In Path enter Xpath of the field you want to promote, in this case /ZDELVRY03_620/IDOC/EDI_DC40/TABNAM
, Click on Save Property 
. Save the document which will take you back to the transaction template creation page

[[img-source-document-properties-view, Source Document (Properties View)]]
image::tutorial/source-document-properties-view.png[img-source-document-properties-view, title="Source Document (Properties View)"]

. Click on Save Template +
The template can be used to define all the integration that involves message type ZDELVRY03_620 from SAP +
Now it is time to add a Receive endpoint to receive the shipment from SAP
. In relationship SAP ↔*Any, click on Endpoints

[[img-endpoints, Endpoints]]
image::tutorial/endpoints.png[img-endpoints, title="Endpoints"]

. Click *New*.

[[img-new-endpoint, New Endpoint]]
image::tutorial/new-endpoint.png[img-new-endpoint, title="New Endpoint"]

. Select protocol as HTTP +
Type: Receive +
Protocol Affinity: None +
. Uncheck Uses Persistence Settings and Default for SAP : Any
. Let the Global Configuration Settings unchanged

[[img-endpoint-operation-settings, Endpoint Operation Settings]]
image::tutorial/endpoint-operation-settings.png[img-endpoint-operation-settings, title="Endpoint Operation Settings"]

. In the Operation Settings section: +
Host : 0.0.0.0 +
Port: 8089 +
Path: /pxhub/sap/api/v1/shipment +
Allowed methods: POST +
. In the Properties tab, click *New Property*

[[img-new-property, New Property]]
image::tutorial/new-property.png[img-new-property, title="New Property"]

. On the page: +
Property Type: From Partner Identifier +
Property Source Type: Constant +
Path: SAP 

. Click Save button on the endpoint
 

=== Create and Configure SalesForce Application  

. Click on View Relationships, select Salesforce ↔ *Any
. On the lefthand menu click on the Document Types

[[img-document-types, Document Types]]
image::tutorial/document-types.png[img-document-types, title="Document Types"]

. Click *New*
. Select *JSON* as standard
. Enter *SalesforceShipment* as message type 
. Click *Save*.
. On the left-hand menu, click *Endpoints*.
. Click *New*/
. Select the protocol as HTTP +
Type: HTTP

. Uncheck Uses Persistence Settings and Default for SAP : Any
. Let the Global Configuration Settings unchanged
. In the Operation Settings section: +
Host : routing-engine-demo-api.us-w2.cloudhub.io +
Port: 80 +
Path: demoapps/system/api/shipments +
Method: POST 
. In the Authentication section: +
Set Type : None

=== Configure Shipment Transaction from SAP to SalesForce

Now that we have the reusable component configured, it is time to set up a Shipment transaction from SAP to SalesForce

. On the Left-hand Menu, navigate to Relationships
. Select Applications Tab
. Click *Add Relationship*

[[img-add-relationship, Add Relationship]]
image::tutorial/add-relationship.png[img-add-relationship, title="Add Relationship"]

. Set the applications to SAP and SalesForce
. Click *Submit*
. On the relationship SAP ↔ Salesforce:
.. Navigate to Transaction designer and click on Start From Template
.. Select the template created 

[[img-pick-a-template, Pick a Template]]
image::tutorial/pick-a-template.png[img-pick-a-template, title="Pick a Template"]

This gets the source channel pre-populated


[[img-pre-populated-source-channel, Pre-populated Source Channel]]
image::tutorial/pre-populated-source-channel.png[img-pre-populated-source-channel, title="Pre-populated Source Channel"]

. On the target channel, click *Create New Channel*

[[img-new-target-channel, New Target Channel]]
image::tutorial/new-target-channel.png[img-new-target-channel, title="New Target Channel)"]

. On the source document, click *Existing Document*
. Select XML-ZDELVRY03_620:(SAP:Any) generated earlier ( Add link )
. On the Target Document click on select Existing Document 
. Select JSON-SalesforceShipment:(Salesforce:Any)
. On the map click on New Map. +
The Source Document and Target Document will be prepopulated
. In the Mapping Type select Dataweave
. Click on the Script and upload JSON Target Dataweave.dwl  from the artifacts folder
. Click Save
. On the Endpoint, click *Existing*


[[img-pick-an-endpoint, Pick an Endpoint]]
image::tutorial/pick-an-endpoint.png[img-ick-an-endpoint, title="Pick an Endpoint"]

. Select one created earlier in Salesforce:ANY name spaceHTTP-SEND:(Salesforce:Any)
. Click *Save*

[[img-completed-target-channel, Completed Target Channel]]
image::tutorial/completed-target-channel.png[img-completed-target-channel, title="Completed Target Channel"]